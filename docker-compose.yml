services:
  app:
    build:
      context: ./web
      dockerfile: Dockerfile
    container_name: ai-transats-app-${USER_ID:-0}-${HTTP_PORT:-6000}
    ports:
      - "${HTTP_PORT:-6000}:5000"
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
      - ASPNETCORE_URLS=http://+:5000
    volumes:
      - transacts_data:/app/data

  nginx:
    image: nginx:alpine
    ports:
      - "${HTTPS_PORT:-6001}:443"
    container_name: ai-transats-nginx-${USER_ID:-1}-${HTTPS_PORT:-6001}
    volumes:
      - ./conf/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./ssl/fullchain.pem:/etc/nginx/ssl/fullchain.pem:ro
      - ./ssl/privkey.pem:/etc/nginx/ssl/privkey.pem:ro
    depends_on:
      - app
    restart: unless-stopped

volumes:
  transacts_data: